#!/bin/bash

alias ner='ne ./config/routes.rb'
alias rs='rails s'
alias rc='rails c'
alias rr="rrout"
alias migrate="rake db:migrate"
alias goc="gor app/controllers"
alias gom="gor app/models"
alias gov="gor app/views"
alias goa="gor app/assets"
alias gos="gor app/services"
alias gol="gor config/locales"
alias gosp="gor spec"
alias gosps="gor spec/services"
alias gospc="gor spec/controllers"
alias gow="gor app/workers"
alias rnobs="grep -v -e assets -e 'views/' -e 'Binary file' -e 'tmp/' -e 'public/' -e 'log/' -e 'poc/'"
alias rnobs-strict="rnobs | grep -v -e 'spec/' -e 'db/' -e 'config/' -e README"

function gotogem()
{
    cd `gem which $1 | rev | cut -d '/' -f 2- | rev`
}

function gor()
{
    # 1) Rails app
    # 2) Git repository
    path=`find_rails_app_root.rb`
    if [ "$?" == "0" ]; then
	cd "$path/$1"
	return 0
    else
	git rev-parse --git-dir > /dev/null 2> /dev/null
	if [ "$?" == "0" ]; then
	    cd "$(git rev-parse --git-dir)/.."
	else
	    echo "Error: no rails app nor git repository found" > /dev/stderr
	    return 1
	fi
    fi
}

function gotogems()
{
    path=`find_ruby_gems.rb`
    if [ "$?" == "0" ]; then
	cd $path
	return 0
    else
	echo "Error: folder found" > /dev/stderr
	return 1
    fi
}

function rrout()
{
    rake routes | grep "$1"
}

function reset_db()
{
    path=`find_rails_app_root.rb`
    if [ "$?" == "0" ]; then
	rm -f "$path/db/development.sqlite3"
	rm -f "$path/db/test.sqlite3"
	rake db:create
	rake db:migrate
	rake db:seed
	return 0
    else
	echo "Error: no rails app found" > /dev/stderr
	return 1
    fi
}

function rlm()
{
    # rails list models

    previous_pwd=$OLD_PWD
    current_pwd=$(pwd)
    gom || return 1
    ls | sed "s/^/  /g"
    cd "$current_pwd"
    export OLD_PWD="$previous_pwd"
}

function rspec-doc()
{
    rspec $@ --dry-run --format documentation
}

function dbdesc()
{
    path=`find_rails_app_root.rb`
    if [ "$?" == "0" ]; then
	_dbdesc "$path/db/schema.rb" $@
	return 0
    else
	echo "Error: no rails app found" > /dev/stderr
	return 1
    fi
}
